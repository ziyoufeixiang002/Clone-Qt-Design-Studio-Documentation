name: ğŸ¨ Clone Qt Design Studio Documentation

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘ï¼ˆå¼ºçƒˆå»ºè®®é¦–æ¬¡æµ‹è¯•ç”¨ï¼‰
  # schedule:
  #   - cron: '0 3 * * 1'  # æ¯å‘¨ä¸€å‡Œæ™¨3ç‚¹ï¼ˆç¡®è®¤åˆè§„åå†å¯ç”¨ï¼‰

jobs:
  clone-design-studio:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      actions: write
    env:
      TARGET_URL: "https://doc.qt.io/qtdesignstudio/"  # âœ… ç²¾ç¡®æŒ‡å‘ Design Studio æ–‡æ¡£æ ¹ç›®å½•
      DOWNLOAD_DIR: "qtdesignstudio-docs"
    
    steps:
      - name: ğŸ› ï¸ Setup Environment
        run: |
          sudo apt-get update
          sudo apt-get install -y wget zstd
          mkdir -p $DOWNLOAD_DIR

      - name: ğŸŒ Download with Precision Filtering
        run: |
          wget \
            --recursive \
            --no-clobber \
            --page-requisites \
            --convert-links \
            --html-extension \
            --restrict-file-names=ascii \
            --domains doc.qt.io \
            --no-parent \
            --wait=0.7 \
            --random-wait \
            --timeout=25 \
            --tries=3 \
            --user-agent="Mozilla/5.0 (compatible; QtDocsBot/1.0; +https://github.com/YOUR-USERNAME/qt-docs-mirror)" \
            # âœ… å…³é”®å¢å¼ºï¼šä¿ç•™ Design Studio ç‰¹æœ‰èµ„æº
            --accept-regex '\.(html?|css|js|qml|qmlproject|json|xml|md|txt|svg|png|jpg|jpeg|gif|ico|woff2?|ttf|otf)$' \
            --reject-regex '\.(mp[34]|avi|mov|wmv|flv|webm|wav|ogg|zip|rar|tar|gz|bz2|xz|7z|iso|dmg|exe|msi|apk|bin|deb|rpm|pdf|psd|ai|sketch)$' \
            --directory-prefix=$DOWNLOAD_DIR \
            $TARGET_URL
        continue-on-error: true

      - name: ğŸ§¹ Post-Download Cleanup
        run: |
          # æ¸…ç†å¸¦æŸ¥è¯¢å‚æ•°çš„ä¸´æ—¶æ–‡ä»¶ï¼ˆé¿å…Windowsè§£å‹å¤±è´¥ï¼‰
          find $DOWNLOAD_DIR -type f -name "*\?*" -delete 2>/dev/null || true
          # åˆ é™¤ç©ºç›®å½•ï¼ˆwgetå¯èƒ½åˆ›å»ºï¼‰
          find $DOWNLOAD_DIR -type d -empty -delete 2>/dev/null || true

      - name: ğŸ“¦ Compress with Zstandard
        run: zstd -T0 --long -19 -k -f -o qtdesignstudio-docs.zst $DOWNLOAD_DIR

      - name: ğŸ“¤ Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: qtdesignstudio-offline-docs
          path: qtdesignstudio-docs.zst
          retention-days: 14
          compression-level: 0

      - name: ğŸ—‘ï¸ Final Cleanup
        run: rm -rf $DOWNLOAD_DIR qtdesignstudio-docs.zst
        if: always()
